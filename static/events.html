<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>售票中場次 | Pitch-A-Seat</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Noto Sans TC", sans-serif;
        background: #f8f9fa;
        padding-top: 60px;
      }

      .navigation {
        display: flex;
        justify-content: center;
        height: 35px;
        padding: 10px 0;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        z-index: 100;
        background-color: black;
        border-bottom: 1px solid #e0e0e0;
      }

      .navlist {
        display: flex;
        justify-content: space-between;
        width: 1200px;
        height: 34px;
      }

      .webtitle {
        font-size: 30px;
        font-weight: 700;
        color: #ffffff;
        line-height: 34px;
        cursor: pointer;
      }

      .nav-item > div {
        color: white;
        padding: 10px;
        cursor: pointer;
      }

      .calendar-controls {
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 20px 0 10px 0;
        gap: 10px;
      }

      .calendar-controls button {
        font-size: 20px;
        padding: 0 10px;
        cursor: pointer;
      }

      .calendar-title {
        font-size: 24px;
        font-weight: bold;
      }

      .calendar {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 1px;
        background: #ccc;
        max-width: 1200px;
        margin: 0 auto;
      }

      .day,
      .weekday {
        background: white;
        padding: 10px;
        min-height: 100px;
        box-sizing: border-box;
      }

      .weekday {
        background: #333;
        color: white;
        font-weight: bold;
        text-align: center;
      }

      .date-num {
        font-weight: bold;
        margin-bottom: 5px;
      }

      .event {
        font-size: 12px;
        background: #ffecb3;
        padding: 2px 4px;
        border-radius: 4px;
        margin-top: 3px;
        line-height: 1.2;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <header>
      <div class="navigation">
        <div class="navlist">
          <div class="webtitle">Pitch-A-Seat</div>
          <div class="nav-item">
            <div class="cart-link">購物車</div>
            <div class="memberpage-link">會員中心</div>
          </div>
        </div>
      </div>
    </header>

    <!-- 月曆控制列 -->
    <div class="calendar-controls">
      <button id="prevMonth">←</button>
      <div class="calendar-title" id="monthLabel">2025年6月</div>
      <button id="nextMonth">→</button>
    </div>

    <!-- 賽程月曆 -->
    <div class="calendar" id="calendar"></div>

    <script>
      const calendar = document.getElementById("calendar");
      const monthLabel = document.getElementById("monthLabel");
      const now = new Date();
      let currentYear = now.getFullYear();
      let currentMonth = now.getMonth() + 1;

      const weekdays = ["日", "一", "二", "三", "四", "五", "六"];

      function renderCalendar(year, month) {
        calendar.innerHTML = "";

        const firstDay = new Date(year, month - 1, 1);
        const daysInMonth = new Date(year, month, 0).getDate();
        const startDay = firstDay.getDay();

        monthLabel.textContent = `${year}年${month}月`;

        weekdays.forEach((day) => {
          const w = document.createElement("div");
          w.className = "weekday";
          w.textContent = day;
          calendar.appendChild(w);
        });

        for (let i = 0; i < startDay; i++) {
          const blank = document.createElement("div");
          blank.className = "day";
          calendar.appendChild(blank);
        }

        fetch(`/api/events?year=${year}&month=${month}`)
          .then((res) => res.json())
          .then((games) => {
            const gameMap = {};
            games.forEach((g) => {
              const day = new Date(g.game_date).getDate();
              if (!gameMap[day]) gameMap[day] = [];
              gameMap[day].push(g);
            });

            for (let i = 1; i <= daysInMonth; i++) {
              const dayBox = document.createElement("div");
              dayBox.className = "day";

              const date = document.createElement("div");
              date.className = "date-num";
              date.textContent = i;
              dayBox.appendChild(date);

              if (gameMap[i]) {
                gameMap[i].forEach((g) => {
                  const e = document.createElement("div");
                  e.className = "event";
                  e.innerHTML = `
                    <div>${g.team_away} vs ${g.team_home}</div>
                    <div>場次：${g.game_number}</div>
                    <div>${g.stadium}</div>
                    <div>${g.start_time}</div>
                    <div>熱賣中：${g.ticket_count} 張</div>
                  `;
                  e.addEventListener("click", () => {
                    window.location.href = `/browse?game_id=${g.game_id}`;
                  });
                  dayBox.appendChild(e);
                });
              }

              calendar.appendChild(dayBox);
            }
          });
      }

      document.getElementById("prevMonth").addEventListener("click", () => {
        currentMonth--;
        if (currentMonth === 0) {
          currentMonth = 12;
          currentYear--;
        }
        renderCalendar(currentYear, currentMonth);
      });

      document.getElementById("nextMonth").addEventListener("click", () => {
        currentMonth++;
        if (currentMonth === 13) {
          currentMonth = 1;
          currentYear++;
        }
        renderCalendar(currentYear, currentMonth);
      });

      document.querySelector(".webtitle").addEventListener("click", () => {
        window.location.href = "/";
      });

      document
        .querySelector(".memberpage-link")
        .addEventListener("click", () => {
          window.location.href = "/membership";
        });

      renderCalendar(currentYear, currentMonth);
    </script>
  </body>
</html>
